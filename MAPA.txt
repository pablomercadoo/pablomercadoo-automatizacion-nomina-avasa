## üìç MAPA DEL PROYECTO ‚Äì Automatizaci√≥n Incidencias AVASA

### üîπ ThisWorkbook

* **Qu√© hace**:
  Arranque y cierre del sistema.
* **Responsabilidades**:

  * Lee configuraci√≥n inicial (locaci√≥n, template).
  * Inicializa variables globales.
  * Muestra el men√∫ principal al abrir.
  * Limpia matrices relevantes al cerrar.
* **Punto cr√≠tico**: si aqu√≠ falla algo, **el sistema ni siquiera arranca**.

---

### üîπ modGlobal

* **Qu√© hace**:
  Guarda el **estado global** del sistema.
* **Variables clave**:

  * A√±o, mes, tipo de periodo, n√∫mero de periodo
  * Locaci√≥n (c√≥digo y display)
  * Bandera de template
* **Regla mental**:
  Todo el sistema asume que estas variables est√°n bien seteadas.

---

### üîπ frmMenuPrincipal

* **Qu√© hace**:
  Es la **puerta de entrada del usuario**.
* **Responsabilidades**:

  * Elegir a√±o, mes, tipo y periodo.
  * Validar que el periodo sea l√≥gico (no futuro).
  * Sincronizar empleados del periodo.
  * Disparar la generaci√≥n de la matriz.
* **Regla clave**:
  Aqu√≠ se define **qu√© periodo est√°s tocando**.

---

### üîπ modReporteIncidencias

* **Qu√© hace**:
  Es el **motor principal del sistema**.
* **Responsabilidades**:

  * Crear o recuperar la hoja matriz del periodo (`M_LOC_AAAA_MM_Q#/S#`)
  * Pintar encabezados, d√≠as, columnas extra
  * Cargar empleados desde la hoja `Empleados`
  * Hacer overlay de incidencias desde `BDIncidencias_Local`
  * Crear botones (Agregar / Editar / Eliminar / Men√∫)
* **Regla clave**:

  * La matriz **siempre se reconstruye**, nunca se edita ‚Äúa mano‚Äù.

---

### üîπ frmIncidencias

* **Qu√© hace**:
  UI para **capturar o editar incidencias** de un empleado.
* **Responsabilidades**:

  * Cargar datos del empleado.
  * Mostrar d√≠as v√°lidos del periodo.
  * Validar c√≥digos de incidencia contra cat√°logo.
  * Guardar incidencias en `BDIncidencias_Local` (UPSERT por UID).
* **Detalle importante**:

  * Usa UID (`LOC|EMP|A√ëO|MES|TIPO|PERIODO|DIA`) para evitar duplicados.
  * Maneja modo **nuevo vs edici√≥n**.

---

### üîπ modSeguridadIncidencias

* **Qu√© hace**:
  Controla **cu√°ndo un periodo se puede editar**.
* **Responsabilidades**:

  * Definir cierre autom√°tico del periodo.
  * Bloquear edici√≥n si el periodo ya cerr√≥.
  * Proteger hojas de matriz.
* **Concepto clave**:

  * El cierre depende de la fecha fin del periodo + ventana de horas (Config).

---

### üîπ modConfig

* **Qu√© hace**:
  Acceso centralizado a la hoja `Config`.
* **Responsabilidades**:

  * Leer valores por clave (`GetConfig`)
  * Evitar valores hardcodeados en el sistema.
* **Regla**:

  * Cualquier par√°metro ‚Äúde negocio‚Äù deber√≠a vivir aqu√≠.

---

### üîπ modAdmin

* **Qu√© hace**:
  Herramientas **administrativas / soporte**.
* **Responsabilidades**:

  * Buscar matrices de periodos pasados.
  * Navegar entre hojas hist√≥ricas.
* **Uso t√≠pico**:

  * Auditor√≠a
  * Soporte
  * Consultas hist√≥ricas

---

### üîπ Hojas del libro (Document / HojaX)

* **Qu√© hacen**:

  * La mayor√≠a no tiene l√≥gica directa.
  * Algunas solo existen como contenedores visibles/ocultos.
* **Regla**:

  * No meter l√≥gica aqu√≠ salvo que sea estrictamente UI.

---

## üß† Regla mental final (important√≠sima)

* **BDIncidencias_Local = verdad**
* **Matriz = vista temporal**
* **Forms = UI**
* **Globals = estado**
* **Config = reglas del negocio**



---

